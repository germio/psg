<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- vim: set filetype=html tabstop=8 : -->
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <link rel="stylesheet" href="psg.css" type="text/css">
  <LINK REL="SHORTCUT ICON" HREF="favicon.ico" type="image/x-icon"/>
  <META NAME="description" content="System Administrator Pocket Survival Guide -  A series of notes for Sys Admin"/>
  <META NAME="keyword" content="Sys Admin, System Administrator, Solaris, HP-UX, AIX, Linux, Note, Notes, Pocket, Survival, Guide, psg, data center, power, electrical, plug, LYS, LKS, LAPPLAPP, PSG101, sn50, tin6150"/>
  <META NAME="Robots" CONTENT="all"/>
  <META NAME="Author" CONTENT="Tin Ho"/>

  <title>Pocket Survival Guide - Vagrant</title>
</head>

<body> 
<div class="navheader">
<table summary="Navigation header" width="100%">
  <tbody>
    <tr>
      <th colspan="9" align="center">
	  
<A HREF="http://tin6150.github.io/psg/">Sys Admin Pocket Survival Guide - OS</A>

      </th>
    </tr>
    <tr>
      <td align="left">  <a accesskey="h" href="psg.html">Home</a>	</td>
      <td align="center"><a accesskey="d" href="docker.html">Docker</a>	</td>
      <td align="center"><a accesskey="p" href="hpux.html">HP-UX</a>	</td>
      <td align="center"><a accesskey="a" href="aix.html">AIX</a>	</td>
      <td align="center"><a accesskey="n" href="netapp.html">NetApp</a>	</td>
      <td align="center"><a accesskey="e" href="emcCelerra.html">EMC(NAS)</a>	</td>
      <td align="center"><a accesskey="E" href="emc.html">EMC(SAN)</a>	</td>
      <td align="center"><a accesskey="v" href="veritas.html">Veritas</a>	</td>
      <td align="right"> <a accesskey="l" href="ldap.html">LDAP</a>	</td>
    </tr>
  </tbody>
</table>
<hr></div>

<div class="chapter" lang="en">
<div class="titlepage">
</div>
</div>

<div align="CENTER">
<A HREF="http://www.explainxkcd.com/wiki/index.php/686"><IMG SRC="fig/xkcd_admin_mourning.png"></A><BR>
</div>


<H1>Vagrant</H1>

<H2>Vagrant Example Use Case</H2>

<PRE>

singhub/ folder has a 
cp Vagranfile.centos7 Vagrantfile 
which download a ready-to-run virtualbox image, eg

	http://cloud.centos.org/centos/7/vagrant/x86_64/images/CentOS-7-x86_64-Vagrant-1805_01.VirtualBox.box
	http://cloud.centos.org/centos/8/vagrant/x86_64/images/CentOS-8-Vagrant-8.0.1905-1.x86_64.vagrant-virtualbox.box

the provision section could run shell commands
OR it can invoke ansible
and execute the vagranfile_playbook.yml

which does some basic setup/cleansing.

Could have this to create VM on Zink for use.
eg Various OS flavor to test out Singularity in them.


PS.
Ansible is not invoking Vagrant to create VM.
VM creation use ansible in two places
- as part of vagrant provision
- IFF full desktop experience inside the VM desired: once machine is a running vm, could run my cueball/ANSIBLE/wsl_locahost_playbook.yml and treat it like any other machine I use.

- historically may have tried osboxes VirtualBox image, but the centos cloud vagrant/box is more scriptable.

</PRE>


<H2>Vagrant 101</H2>

<PRE>

vagrant init 			# will seed a .vagrant/ dir and a new Vagrantfile in current dir
--or--
vi Vagrantfile			# create/edit/cp Vagrantfile.centos8 Vagrantfile

vagrant up


vagrant provision		# (re)run provision section of Vagrantfile 
vagrant provision --debug 	# add debug output to above

	The provision section could run a shell script
	Or a lot of folks also have it run ansible and execute a playbook

vagrant up --provision | tee provision.log	# run vagrant up and forces provision to run

# works on osx sierra, but not on mint rafaela, which needed:
vagrant box add centos/7 https://vagrantcloud.com/centos/boxes/7/versions/1708.01/providers/virtualbox.box   ## this one works!
# see https://github.com/hashicorp/vagrant/issues/5016
# but in mint, still can't do vagrant up, something crashes , but that maybe virtualbox bug... oh, my linux box had been acting up...

vagrant status
vagrant global-status		# multiple Vagrantfile, or global farm 
vagrant suspend			# hibernate vm
vagrant resume			# resume vm after hibernation
vagrant halt			# power off vm
vagrant reload 			# restarts vagrant machine, loads new Vagrantfile configuration
vagrant reload --provision 	# Same as above, but also force provisioning


vagrant box list -i		# -i give extra info.  but container name with /n doesn't show up!  bug??
vagrant box remove -h 		# -h for help on specific subcommand
vagrant box remove foobar/7 virtualbox


#--vagrant destroy		# this will DELETE the box and ...

vagrant push 			# push code with vagrant...
vagrant ssh 			# ssh to vagrant vm.  it has password?  ssh key??

</PRE>

<H5>Vagrantfile</H5>

<BR>
<A HREF="https://github.com/tin6150/singhub/blob/master/Vagrantfile">
Example Vagrantfile</A>.
<BR>


<H2>Multiple instances</H2>

There are likely many scenarios where multiple instances are needed, 
eg multiple machine to support a app/db environment.
Those could be in a vagrantfile with multiple instances defined in it.
<BR><BR>

Here, i cover the case for creating multiple VM that are independent of one another,
for various sys admin testings.
<BR>
eg, a Vagrantfile defining a VM for CentOS 7, another for 8, yet another for FreeBSD 11 or an Ubuntu machine.
<BR>
<BR>
Because vagrant expect one directory to host one config file, 
the fact that one can use <TT>VAGRANT_VAGRANTFILE</TT> to specify an alternate definition file doesn't really help.
This is because there is a .vagrant dir hosting quite a bit of config.

<BR>
Thus, it is best to create one directory for each test env.
This way, 
<TT>VBoxManage list vms</TT>
will also list machines prefixed with the folder name, thus aiding finding out what is what.
eg
<PRE>
"vagrant_centos7_default_1592008049000_63100" {7bfb7f7f-226b-4091-a49a-92d55999f98a}
"vagrant_freeBSD_default_1592249070181_35687" {eea57223-a976-4a5d-a0d7-9deff2d3b748}

</PRE>

<BR>
Furthermore, one now just need to cd to the right directory to do <BR>
<TT>vagrant status</TT> <BR>
<TT>vagrant ssh</TT> <BR>
etc without having to prefix each command with <TT> VAGRANT_VAGRANTFILE=Vagrantfile.centos8</TT>
or having set it in an export and forgot to change it :)
<BR>
<BR>

<H2>Dir Structure</H2>

<PRE>

$HOME/.vagrant.d/ ...

.vagrantfile/		# store info about VM created by vagrant up

VM images, if using VirtualBox, is in $HOME/VirtualBox VMs/VMNAME ie, a location virtual box always use, not dependent on Vagrantfile...
see vboxmanage list vms --long
	

</PRE>

Ref:
Using alternate Vagrantfile was dicussed in
https://stackoverflow.com/questions/23888381/how-to-run-several-boxes-with-vagrant
but i think that point is moot now.


<H2>Installation</H2>

<PRE>
Mint:    
sudo apt-get install vagrant virtualbox
sudo apt     install virtualbox-qt       # needed by startvm hexcode --type gui

Centos7: 
yum -y install https://releases.hashicorp.com/vagrant/1.9.6/vagrant_1.9.6_x86_64.rpm
# https://www.tecmint.com/how-to-install-vagrant-on-centos-7/ says vagrant can use docker too...
# but not so sure.  vagrant ask for VirtualBox, VMware, hyperV.  

# yum -y install virt-what              # inside VM, tell/guess what env is in.

Mac:
cd ~/Downloads
wget https://releases.hashicorp.com/vagrant/2.0.0/vagrant_2.0.0_x86_64.dmg
sudo hdiutil attach vagrant_2.0.0_x86_64.dmg
sudo installer -package /Volumes/Vagrant/vagrant.pkg -target /
# installed to /opt/vagrant with link in /usr/local
sudo hdiutil detach /Volumes/Vagrant

wget http://download.virtualbox.org/virtualbox/5.1.28/VirtualBox-5.1.28-117968-OSX.dmg
sudo hdiutil attach VirtualBox-5.1.28-117968-OSX.dmg 
sudo installer -package /Volumes/VirtualBox/VirtualBox.pkg -target /
# installed to /Applications/VirtualBox.app
sudo hdiutil detach /Volumes/VirtualBox/
</PRE>


<H2>Links</H2>

<UL>
	<LI><A HREF="https://www.vagrantup.com/docs/other/environmental-variables.html">Vagrant env vars</A></LI>


</UL>


<H1>Virtual Box</H1>

<PRE>
/usr/bin/vboxmanage 
vboxmanage list vms
vboxmanage list vms --long
vboxmanage showvminfo

/usr/bin/VBoxManage  startvm   "springer"           --type headless
/usr/bin/VBoxManage  controlvm "springer"  poweroff --type headless


</PRE>



<BR>
<BR>
<BR>


<BR><HR>
<div align="CENTER">
  [Doc URL: <A HREF="http://tin6150.github.io/psg/">
http://tin6150.github.io/psg/vagrant.html
</A>] <BR>
Last Updated: 2017-10-09
  <!--[Doc URL: <A HREF="http://psg.ask-margo.com/">http://psg.ask-margo.com/</A>] <BR>-->
<BR>
(cc) Tin Ho. See 
<A HREF=psg.html#cc>main page</A>
 for copyright info. <BR>
<HR>
<A HREF="http://www.taos.com"><IMG SRC="banner/taos_banner1.gif" width="728" height="98"></A>
</div>
<div class="sig"><BR>
  hoti1<BR>
  sn5050<BR>
  psg101 sn50 tin6150</div>


</body>

<!-- Google analytics new tracking code ga.js.   Will actually need to add this code to every page for full tracking!    (still the case in 2011?) Using my gmail login 2011.0617 updated with code for http://tin6150.github.io/psg/psg.html -->    <script type="text/javascript">    var _gaq = _gaq || [];   _gaq.push(['_setAccount', 'UA-4515095-4']);   _gaq.push(['_trackPageview']);    (function() {     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);   })();  </script>


</html>
